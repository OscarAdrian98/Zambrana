{% extends "base.html" %}
{% block title %}Resumen{% endblock %}

{% block content %}
<!-- Logo -->
<div class="bg-white text-center py-2 border-bottom shadow-sm">
    <img src="{{ url_for('static', filename='logo-zambrana.jpg') }}" alt="Logo Zambrana" style="height: 55px;">
</div>

<!-- T√≠tulo -->
<div class="text-center mt-3">
    <h4 class="fw-bold">Resumen de fichajes</h4>
</div>

<!-- Filtros -->
<div class="card p-4 shadow-sm bg-white mb-4 mx-auto" style="max-width: 1150px;">
    <form method="GET" class="row g-3 align-items-end">
        <div class="col-12 col-md-4">
            <label class="form-label">Desde:</label>
            <input type="date" name="desde" class="form-control" value="{{ desde }}">
        </div>
        <div class="col-12 col-md-4">
            <label class="form-label">Hasta:</label>
            <input type="date" name="hasta" class="form-control" value="{{ hasta }}">
        </div>
        <div class="col-12 col-md-4 d-grid gap-2 d-md-flex">
            <button type="submit" class="btn btn-primary w-100 w-md-auto">üîé Filtrar</button>
            <a href="{{ url_for('resumen') }}" class="btn btn-outline-secondary w-100 w-md-auto">‚ùå Limpiar</a>
        </div>
    </form>
</div>

<!-- Exportaciones -->
<div class="d-flex flex-column flex-md-row justify-content-center align-items-center gap-2 mb-4 px-2">
    <a href="{{ url_for('exportar_mis_fichajes', desde=desde, hasta=hasta) }}" class="btn btn-success px-4 py-2">
        üì• Descargar Excel
    </a>
    <a href="{{ url_for('exportar_mis_fichajes_pdf', desde=desde, hasta=hasta) }}" class="btn btn-danger px-4 py-2" download>
        üßæ Descargar PDF
    </a>
</div>

<!-- Listado por d√≠a -->
<div class="mb-5 px-2">
    {% for row in datos %}
    <div class="card shadow-sm mb-3">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <span class="fw-bold"><i class="bi bi-calendar-event me-2"></i>{{ row.fecha }}</span>
            <span class="badge bg-dark text-white">{{ row.total or '-' }}</span>
        </div>
        <div class="card-body p-3 pt-2">
            {% if row.registros %}
                <ul class="list-unstyled mb-0">
                    {% for r in row.registros %}
                    <li class="mb-1">
                        <span class="fw-bold {% if r.tipo == 'entrada' %}text-success{% else %}text-danger{% endif %}">
                            {{ r.tipo.capitalize() }}
                        </span>
                        - {{ r.hora }}
                        <span class="badge rounded-pill 
                            {% if r.origen == 'Remoto' %}bg-info 
                            {% elif r.origen == 'Tienda' %}bg-secondary
                            {% else %}bg-light text-dark{% endif %}">
                            {{ r.origen or 'Tienda' }}
                        </span>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted mb-0">Sin registros.</p>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<!-- Navegaci√≥n inferior -->
<nav class="navbar fixed-bottom bg-white border-top d-flex justify-content-around py-2">
    <a href="{{ url_for('fichar') }}" class="text-center {% if request.path == '/fichar' %}text-primary fw-bold{% endif %}">
        <div><i class="bi bi-house-door-fill"></i></div>
        <div style="font-size: 0.9rem;">Inicio</div>
    </a>
    <a href="{{ url_for('control_horario') }}" class="text-center {% if request.path == '/control-horario' %}text-primary fw-bold{% endif %}">
        <div><i class="bi bi-clock-history"></i></div>
        <div style="font-size: 0.9rem;">Horarios</div>
    </a>
    <a href="{{ url_for('resumen') }}" class="text-center {% if request.path == '/resumen' %}text-primary fw-bold{% endif %}">
        <div><i class="bi bi-calendar3"></i></div>
        <div style="font-size: 0.9rem;">Calendario</div>
    </a>
    <a href="{{ url_for('mis_ausencias') }}" class="text-center {% if request.path == '/mis-ausencias' %}text-primary fw-bold{% endif %}">
        <div><i class="bi bi-calendar-check"></i></div>
        <div style="font-size: 0.9rem;">Vacaciones</div>
    </a>
    <a href="{{ url_for('perfil') }}" class="text-center {% if request.path == '/perfil' %}text-primary fw-bold{% endif %}">
        <div><i class="bi bi-person-circle"></i></div>
        <div style="font-size: 0.9rem;">Perfil</div>
    </a>

    {% if current_user.admin %}
    <a href="{{ url_for('admin_fichajes') }}" class="text-center {% if '/admin' in request.path %}text-primary fw-bold{% endif %}">
        <div><i class="bi bi-tools"></i></div>
        <div style="font-size: 0.9rem;">Admin</div>
    </a>
    {% endif %}

</nav>
{% endblock %}