<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Fichaje{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <!-- Tu hoja de estilos personalizada -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>

    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            display: flex;
            flex-direction: column;
            background-color: #f8f9fa;
            overflow: hidden;
        }

        main {
            flex-grow: 1;
            min-height: calc(100vh - 60px); /* deja hueco para el men√∫ inferior */
            overflow-y: auto;
        }

        /* Estilo para d√≠as seleccionados en el calendario de ausencias */
        #calendario_ausencias .flatpickr-day.selected {
            background: #0d6efd;
            color: white;
            border-color: #0d6efd;
        }
    </style>
</head>
<body>

<!-- Contenido principal scrollable -->
<main>
    <div class="container py-3">
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="alert alert-info">
              {% for msg in messages %}
                <div>{{ msg }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
        <div style="height: 80px;"></div>  <!-- üëà A√ëADIDO -->
    </div>
</main>

<!-- Script para resaltar festivos y forzar Flatpickr en m√≥viles -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const year = new Date().getFullYear();
    const festivos = [];

    fetch(`https://date.nager.at/api/v3/PublicHolidays/${year}/ES`)
        .then(response => response.json())
        .then(data => {
            data.forEach(dia => {
                if (!dia.counties || dia.counties.includes("ES-AN")) {
                    festivos.push(dia.date);
                }
            });

            const inputs = document.querySelectorAll("input[type='date']");

            inputs.forEach(input => {
                flatpickr(input, {
                    dateFormat: "Y-m-d",
                    altInput: true,
                    altFormat: "d/m/Y",
                    locale: "es",
                    disableMobile: true,
                    defaultDate: input.value || "today",
                    onDayCreate: function (dObj, dStr, fp, dayElem) {
                        const fecha = dayElem.dateObj.toISOString().split('T')[0];
                        if (festivos.includes(fecha)) {
                            dayElem.style.backgroundColor = "#ffdddd";
                            dayElem.style.color = "red";
                            dayElem.title = "Festivo";
                        }
                    }
                });
            });
        });
});
</script>

</body>
</html>